(this["webpackJsonpreport-demo"]=this["webpackJsonpreport-demo"]||[]).push([[0],{233:function(e,t,r){},369:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(48),o=r.n(c),s=(r(233),r(24)),i=r(8),l=r.n(i),u=r(16),d=r(17),j=r(11),b=r(64),f=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.from,n=t.to,e.next=3,fetch("".concat("/api/reports/invoice","?from=").concat(r,"&to=").concat(n));case 3:return a=e.sent,e.next=6,a.json();case 6:return c=e.sent,console.log("From fetchInvoiceReport: ",c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=r(137),O=r(59),h=r(135),v=r(95),x=r.n(v),m=r(1),g=function(e){var t=e.data,r=void 0===t?[]:t,n=e.loading,a=e.columns,c=void 0===a?[]:a,o=e.filterPlaceholder,s=e.onFilter,i=e.maxheight,l=e.showFooter,d=void 0!==l&&l,j=e.onRowSelect,b=Object(h.useTable)({columns:c,data:r,stateReducer:function(e,t){return"toggleRowSelected"===t.type&&(e.selectedRowIds=Object(O.a)({},t.id,!t.isSelected)),e}},h.useRowSelect),f=b.getTableProps,p=b.getTableBodyProps,v=b.headerGroups,g=b.footerGroups,w=b.rows,S=b.prepareRow,y=(b.selectedFlatRows,x()((function(e){s(e)}),500));return Object(m.jsxs)(m.Fragment,{children:[s&&Object(m.jsx)("div",{className:"table-filter-container",children:Object(m.jsx)("input",{className:"table-filter-input",onChange:function(e){return y(e.target.value)},placeholder:o,autoFocus:!0})}),Object(m.jsx)("div",{className:"table-container",maxheight:i,children:Object(m.jsxs)("table",Object(u.a)(Object(u.a)({},f()),{},{children:[Object(m.jsx)("thead",{children:v.map((function(e){return Object(m.jsx)("tr",Object(u.a)(Object(u.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(m.jsx)("th",Object(u.a)(Object(u.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(m.jsx)("tbody",Object(u.a)(Object(u.a)({},p()),{},{children:w.map((function(e){return S(e),Object(m.jsx)("tr",Object(u.a)(Object(u.a)(Object(u.a)({},e.getRowProps({onClick:j?function(){e.toggleRowSelected(),j()}:null})),e.getToggleRowSelectedProps({})),{},{children:e.cells.map((function(t,r){return Object(m.jsx)("td",Object(u.a)(Object(u.a)({title:t.value},t.getCellProps()),{},{style:{background:e.isSelected?"lightgreen":"white"},children:t.render("Cell")}))}))}))}))})),d&&Object(m.jsx)("tfoot",{children:g.map((function(e){return Object(m.jsx)("tr",Object(u.a)(Object(u.a)({},e.getFooterGroupProps()),{},{children:e.headers.map((function(e){return Object(m.jsx)("td",Object(u.a)(Object(u.a)({},e.getFooterProps()),{},{children:e.render("Footer")}))}))}))}))})]}))}),n&&Object(m.jsx)("div",{className:"loading-container",data:r.length?1:0,children:"Cargando..."})]})},w=[{Header:"Producto",accessor:"product"},{Header:"Cantidad",accessor:"quantity"},{Header:"Bruto",accessor:"rawProfit",Cell:function(e){var t=e.value;return t?"$"+t.toLocaleString():""},Footer:function(e){var t=e.data.reduce((function(e,t){return e+t.rawProfit}),0);return"$"+Number(t.toFixed(2)).toLocaleString()}},{Header:"Utilidad",accessor:"netProfit",Cell:function(e){var t=e.value;return t?"$"+t.toLocaleString():""},Footer:function(e){var t=e.data.reduce((function(e,t){return e+t.netProfit}),0);return"$"+Number(t.toFixed(2)).toLocaleString()}},{Header:"Promedio",accessor:"averageProfitPercent",Cell:function(e){return e.value+"%"}}],S=function(e){var t=e.data,r=Object(n.useMemo)((function(){return w}));return Object(m.jsx)(g,{data:t,columns:r,showFooter:!0})},y=function(e){var t=e.data,r=void 0===t?[]:t,a=e.onFilter,c=Object(n.useState)("rawProfit"),o=Object(j.a)(c,2),i=o[0],l=o[1],u=Object(n.useState)([]),d=Object(j.a)(u,2),b=d[0],f=d[1];return Object(n.useEffect)((function(){var e=r.sort((function(e,t){return t[i]-e[i]}));f(Object(s.a)(e))}),[i,r]),Object(m.jsxs)("div",{className:"card",children:[Object(m.jsxs)("div",{className:"card-header",children:[Object(m.jsx)("h2",{children:"Ventas"}),Object(m.jsxs)("div",{children:[Object(m.jsx)("label",{children:"Ordenar: "}),Object(m.jsxs)("select",{onChange:function(e){return l(e.target.value)},value:i,children:[Object(m.jsx)("option",{value:"quantity",children:"Cantidad"}),Object(m.jsx)("option",{value:"rawProfit",children:"Bruto"}),Object(m.jsx)("option",{value:"netProfit",children:"Utilidad"}),Object(m.jsx)("option",{value:"averageProfitPercent",children:"Promedio"})]})]})]}),Object(m.jsx)("div",{className:"card-body",children:b.length>0&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("input",{className:"input-filter",placeholder:"Buscar...",type:"search",onChange:function(e){return a(e.target.value,"product","sale_report")}}),Object(m.jsx)(S,{data:b})]})})]})},C=[{Header:"Cliente",accessor:"client"},{Header:"Total",accessor:"total_USD",Cell:function(e){return"$"+e.value.toLocaleString()}}],k=function(e){var t=e.data,r=Object(n.useMemo)((function(){return C}));return Object(m.jsx)(g,{data:t,columns:r})},L=function(e){var t=e.data,r=void 0===t?[]:t,n=e.onFilter;return Object(m.jsxs)("div",{className:"card",children:[Object(m.jsx)("div",{className:"card-header",children:Object(m.jsx)("h2",{children:"Clientes"})}),Object(m.jsx)("div",{className:"card-body",children:r.length>0&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("input",{className:"input-filter",placeholder:"Buscar...",type:"search",onChange:function(e){return n(e.target.value,"client","client_report")}}),Object(m.jsx)(k,{data:r})]})})]})},_=r(222),N=r(218),P=r.n(N),F=function(e){var t=e.placeholder,r=e.loadOptions,n=e.defaultOptions,a=void 0===n||n,c=e.cacheOptions,o=void 0===c||c,s=e.onSelect;return Object(m.jsx)(_.a,{loadOptions:P()((function(e,t){return r(e,t)}),700),cacheOptions:o,defaultOptions:a,placeholder:t,onChange:s,loadingMessage:function(){return"Cargando..."},isClearable:!0})},D="/api/products",R="/api/reports/products",H=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filter,n=r?"?filter=".concat(r):"",e.next=4,fetch(D+n);case 4:return a=e.sent,e.next=7,a.json();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(D,"/price-list/").concat(t));case 2:return r=e.sent,n=r.json(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(R,"/cost-fluctuation/").concat(t));case 2:return r=e.sent,n=r.json(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(d.a)(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(R,"/best-clients/").concat(t,"?from=").concat(r.from,"&to=").concat(r.to));case 2:return n=e.sent,a=n.json(),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),$=function(e){var t=e.onSelect,r=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H({filter:t});case 2:if(!((r=e.sent)&&r.length>0)){e.next=6;break}return n=r.map((function(e){var t=e.Descripcion;return{key:e.id,label:t,value:e}})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsx)(F,{loadOptions:r,defaultOptions:!1,placeholder:"Buscar producto...",onSelect:function(e,r){var n=r.action;"select-option"===n?t(e.value,n):"clear"===n&&t(null,n)}})},M=r(223),A=function(){var e=Object(n.useState)(null),t=Object(j.a)(e,2),r=t[0],a=t[1],c=Object(n.useState)([]),o=Object(j.a)(c,2),s=o[0],i=o[1];return Object(n.useEffect)((function(){if(r){var e=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(r.IdProducto);case 2:t=e.sent,console.log(t),i([t]);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else r||i([])}),[r]),Object(m.jsxs)("div",{className:"card",children:[Object(m.jsx)("div",{className:"card-header",children:Object(m.jsx)("h2",{children:"Promedio mensual costo"})}),Object(m.jsxs)("div",{className:"card-body",children:[Object(m.jsx)($,{onSelect:a}),Object(m.jsx)(M.a,{data:s,margin:{top:20,right:30,bottom:80,left:40},xScale:{type:"point"},yScale:{type:"linear",min:"auto",max:"auto",stacked:!0,reverse:!1},axisTop:null,axisRight:null,pointSize:10,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0})]})]})},U=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filter,n=r?"?filter=".concat(r):"",e.next=4,fetch("/api/groups"+n);case 4:return a=e.sent,e.next=7,a.json();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(e){var t=e.onSelect,r=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U({filter:t});case 2:if(!((r=e.sent)&&r.length>0)){e.next=6;break}return n=r.map((function(e){return{key:e.groupId,label:e.name,value:e}})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsx)("div",{style:{width:"100%"},children:Object(m.jsx)(F,{loadOptions:r,placeholder:"Buscar categor\xeda...",onSelect:function(e,r){var n=r.action;"select-option"===n?t(e.value,n):"clear"===n&&t(null,n)}})})},G=[{Header:"Producto",accessor:"product"},{Header:"Precio",accessor:"price"},{Header:"Inventario",accessor:"stock"}],q=function(e){var t=e.data,r=Object(n.useMemo)((function(){return G}));return Object(m.jsx)(g,{data:t,columns:r})},W=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Object(n.useState)(t),a=Object(j.a)(r,2),c=a[0],o=a[1],s=x()((function(e,t,r){r?l(e,t,r):i(e,t)}),500),i=function(t,r){var n=e.filter((function(e){return e[r].toLowerCase().includes(t.toLowerCase())}));return o(n),n},l=function(t,r,n){console.log("nestedKLey",n);var a=e[n].filter((function(e){return e[r].toLowerCase().includes(t.toLowerCase())}));o(Object(u.a)(Object(u.a)({},c),{},Object(O.a)({},n,a)))};return{filter:i,filteredData:c,setFilteredData:o,onFilterDebounced:s}},J=function(){var e=Object(n.useState)(null),t=Object(j.a)(e,2),r=t[0],a=t[1],c=Object(n.useState)([]),o=Object(j.a)(c,2),i=o[0],u=o[1],b=W(i),f=b.filteredData,p=b.setFilteredData,O=b.onFilterDebounced,h=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(r){var e=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(r.groupId);case 2:t=e.sent,p([]),h.current.value="",u(Object(s.a)(t));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else r||u([])}),[r]),Object(m.jsxs)("div",{className:"card",children:[Object(m.jsx)("div",{className:"card-header",children:Object(m.jsx)("h2",{children:"Lista de precio por categor\xeda"})}),Object(m.jsxs)("div",{className:"card-body",children:[Object(m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:"40%"},children:[Object(m.jsx)(E,{onSelect:a}),Object(m.jsx)("input",{ref:h,className:"input-filter",placeholder:"Buscar...",type:"search",onChange:function(e){O(e.target.value,"product")}})]}),Object(m.jsx)(q,{data:f.length>0?f:i})]})]})},z=[{Header:"Cliente",accessor:"client"},{Header:"Cantidad",accessor:"quantity_total"},{Header:"Total",accessor:"total_USD",Cell:function(e){var t=e.value;return t?"$"+t.toLocaleString():""}},{Header:"Utilidad",accessor:"utilidad",Cell:function(e){var t=e.value;return t?"$"+t.toLocaleString():0}}],K=function(e){var t=e.data,r=Object(n.useMemo)((function(){return z}));return Object(m.jsx)(g,{data:t,columns:r})},V=function(e){var t=e.dateRange,r=Object(n.useState)(null),a=Object(j.a)(r,2),c=a[0],o=a[1],s=Object(n.useState)([]),i=Object(j.a)(s,2),u=i[0],f=i[1];return Object(n.useEffect)((function(){if(c&&t){var e=function(){var e=Object(d.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(c.IdProducto,t);case 2:r=e.sent,f(r);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else c||f([])}),[c,t]),Object(m.jsxs)("div",{className:"card",children:[Object(m.jsxs)("div",{className:"card-header",children:[Object(m.jsx)("h2",{children:"Mejor cliente por producto"}),Object(m.jsxs)("div",{style:{flexDirection:"row",gap:"5px"},children:[Object(m.jsx)("label",{children:"Desde: "}),Object(m.jsxs)("strong",{children:[b.DateTime.fromISO(t.from).toLocaleString()," "]}),Object(m.jsx)("label",{children:"Hasta: "}),Object(m.jsxs)("strong",{children:[b.DateTime.fromISO(t.to).toLocaleString()," "]})]})]}),Object(m.jsxs)("div",{className:"card-body",children:[Object(m.jsx)("div",{style:{display:"flex",flex:"1",justifyContent:"space-between"},children:Object(m.jsx)("div",{style:{width:"100%"},children:Object(m.jsx)($,{onSelect:o})})}),u.length>0&&Object(m.jsx)(K,{data:u})]})]})};var Y=function(){var e=Object(n.useState)({from:b.DateTime.now().toISODate(),to:b.DateTime.now().toISODate()}),t=Object(j.a)(e,2),r=t[0],a=t[1],c=Object(n.useState)({sale_report:[],categories_report:[],client_report:[],new_clients_report:[]}),o=Object(j.a)(c,2),i=o[0],O=o[1],h=Object(n.useState)({sale_report:[],categories_report:[],client_report:[],buy_price_fluctuation:[],new_clients_report:[]}),v=Object(j.a)(h,2),x=v[0],g=v[1],w=W(i,{sale_report:[],categories_report:[],client_report:[],new_clients_report:[]}),S=w.filteredData,C=w.onFilterDebounced,k=function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,f(r);case 3:n=e.sent,O(Object(u.a)({},n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){var e=i.categories_report.reduce((function(e,t){return[].concat(Object(s.a)(e),[{id:t.categoria,label:t.categoria,value:t.rawProfit,netProfit:t.netProfit}])}),[]),t=i.client_report.reduce((function(e,t){return[].concat(Object(s.a)(e),[{id:t.client,label:t.client,value:t.total_USD}])}),[]);g(Object(u.a)(Object(u.a)({},x),{},{categories_report:e,client_report:t}))}),[i]),Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)("div",{id:"date-range-wrapper",children:Object(m.jsxs)("div",{id:"date-range-container",children:[Object(m.jsx)("label",{children:"Desde:"}),Object(m.jsx)("input",{type:"date",value:r.from,onChange:function(e){return a(Object(u.a)(Object(u.a)({},r),{},{from:e.target.value}))}}),Object(m.jsx)("label",{children:"Hasta:"}),Object(m.jsx)("input",{type:"date",value:r.to,onChange:function(e){return a(Object(u.a)(Object(u.a)({},r),{},{to:e.target.value}))}}),Object(m.jsx)("input",{type:"submit",onClick:k})]})}),Object(m.jsxs)("main",{id:"main",children:[Object(m.jsxs)("div",{id:"left-content",children:[Object(m.jsx)(y,{data:S.sale_report.length?S.sale_report:i.sale_report,onFilter:C}),Object(m.jsx)(L,{data:S.client_report.length?S.client_report:i.client_report,onFilter:function(e,t){return C(e,t)}}),Object(m.jsx)(A,{})]}),Object(m.jsxs)("div",{id:"right-content",children:[Object(m.jsx)(V,{dateRange:r}),Object(m.jsx)(J,{}),Object(m.jsxs)("div",{className:"card",children:[Object(m.jsx)("div",{className:"card-header",children:Object(m.jsx)("h2",{children:"Gr\xe1fico de categor\xedas"})}),Object(m.jsx)("div",{className:"card-body",children:x.categories_report.length>0&&Object(m.jsx)(p.a,{data:x.categories_report,margin:{top:30,right:20,bottom:20,left:20},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,arcLabel:function(e){return"".concat(e.value," (").concat(e.data.netProfit,")")},borderWidth:1,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:"#333333",arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLabelsSkipAngle:10,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},tooltip:function(e){var t=e.datum;return Object(m.jsxs)("div",{className:"tooltip-container",children:[Object(m.jsx)("span",{className:"small-square",style:{background:t.color}}),Object(m.jsx)("strong",{children:t.label}),Object(m.jsx)("label",{children:"Bruto: "}),Object(m.jsxs)("span",{children:["$",Number(t.value).toLocaleString()]}),Object(m.jsx)("label",{children:"Utilidad: "}),Object(m.jsxs)("span",{children:["$",Number(t.data.netProfit).toLocaleString()]})]})}})})]}),Object(m.jsxs)("div",{className:"card",children:[Object(m.jsx)("div",{className:"card-header",children:Object(m.jsx)("h2",{children:"Gr\xe1fico de clientes"})}),Object(m.jsx)("div",{className:"card-body",children:x.client_report.length>0&&Object(m.jsx)(p.a,{data:x.client_report,margin:{top:30,right:20,bottom:20,left:20},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderWidth:1,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:"#333333",arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLabelsSkipAngle:10,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]}})})]})]})]})]})};o.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(Y,{})}),document.getElementById("root"))}},[[369,1,2]]]);
//# sourceMappingURL=main.bf7761cd.chunk.js.map