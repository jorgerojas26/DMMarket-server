(this["webpackJsonpreport-demo"]=this["webpackJsonpreport-demo"]||[]).push([[0],{233:function(e,t,r){},369:function(e,t,r){"use strict";r.r(t);var n=r(0),c=r.n(n),a=r(48),o=r.n(a),i=(r(233),r(31)),s=r(11),l=r.n(s),d=r(16),u=r(23),j=r(12),b=r(59),p=r(126),h=r(90),O=r.n(h),f=r(2),x=function(e){var t=e.data,r=void 0===t?[]:t,n=e.loading,c=e.columns,a=void 0===c?[]:c,o=e.filterPlaceholder,i=e.onFilter,s=e.maxheight,l=e.showFooter,u=void 0!==l&&l,j=e.onRowSelect,h=Object(p.useTable)({columns:a,data:r,stateReducer:function(e,t){return"toggleRowSelected"===t.type&&(e.selectedRowIds=Object(b.a)({},t.id,!t.isSelected)),e}},p.useRowSelect),x=h.getTableProps,v=h.getTableBodyProps,m=h.headerGroups,g=h.footerGroups,_=h.rows,w=h.prepareRow,S=(h.selectedFlatRows,O()((function(e){i(e)}),500));return Object(f.jsxs)(f.Fragment,{children:[i&&Object(f.jsx)("div",{className:"table-filter-container",children:Object(f.jsx)("input",{className:"table-filter-input",onChange:function(e){return S(e.target.value)},placeholder:o,autoFocus:!0})}),Object(f.jsx)("div",{className:"table-container",maxheight:s,children:Object(f.jsxs)("table",Object(d.a)(Object(d.a)({},x()),{},{children:[Object(f.jsx)("thead",{children:m.map((function(e){return Object(f.jsx)("tr",Object(d.a)(Object(d.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(f.jsx)("th",Object(d.a)(Object(d.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(f.jsx)("tbody",Object(d.a)(Object(d.a)({},v()),{},{children:_.map((function(e){return w(e),Object(f.jsx)("tr",Object(d.a)(Object(d.a)(Object(d.a)({},e.getRowProps({onClick:j?function(){e.toggleRowSelected(),j()}:null})),e.getToggleRowSelectedProps({})),{},{children:e.cells.map((function(t,r){return Object(f.jsx)("td",Object(d.a)(Object(d.a)({title:t.value},t.getCellProps()),{},{style:{background:e.isSelected?"lightgreen":"white"},children:t.render("Cell")}))}))}))}))})),u&&Object(f.jsx)("tfoot",{children:g.map((function(e){return Object(f.jsx)("tr",Object(d.a)(Object(d.a)({},e.getFooterGroupProps()),{},{children:e.headers.map((function(e){return Object(f.jsx)("td",Object(d.a)(Object(d.a)({},e.getFooterProps()),{},{children:e.render("Footer")}))}))}))}))})]}))}),n&&Object(f.jsx)("div",{className:"loading-container",data:r.length?1:0,children:"Cargando..."})]})},v=[{Header:"Producto",accessor:"product"},{Header:"Cantidad",accessor:"quantity"},{Header:"Bruto",accessor:"rawProfit",Cell:function(e){var t=e.value;return t?"$"+t.toLocaleString():""},Footer:function(e){var t=e.data.reduce((function(e,t){return e+t.rawProfit}),0);return"$"+Number(t.toFixed(2)).toLocaleString()}},{Header:"Utilidad",accessor:"netProfit",Cell:function(e){var t=e.value;return t?"$"+t.toLocaleString():""},Footer:function(e){var t=e.data.reduce((function(e,t){return e+t.netProfit}),0);return"$"+Number(t.toFixed(2)).toLocaleString()}}],m=function(e){var t=e.data,r=Object(n.useMemo)((function(){return v}));return Object(f.jsx)(x,{data:t,columns:r,showFooter:!0})},g=[{Header:"Cliente",accessor:"client"},{Header:"Total",accessor:"total_USD",Cell:function(e){return"$"+e.value.toLocaleString()}}],_=function(e){var t=e.data,r=Object(n.useMemo)((function(){return g}));return Object(f.jsx)(x,{data:t,columns:r})},w=r(136),S=function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.from,n=t.to,e.next=3,fetch("".concat("/api/reports/invoice","?from=").concat(r,"&to=").concat(n));case 3:return c=e.sent,e.next=6,c.json();case 6:return a=e.sent,console.log("From fetchInvoiceReport: ",a),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=r(137),y=function(e){var t=e.data,r=void 0===t?[]:t,n=e.onFilter;return Object(f.jsxs)("div",{className:"card",children:[Object(f.jsx)("div",{className:"card-header",children:Object(f.jsx)("h2",{children:"Ventas"})}),Object(f.jsx)("div",{className:"card-body",children:r.length>0&&Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("input",{className:"input-filter",placeholder:"Buscar...",type:"search",onChange:function(e){return n(e.target.value,"sale_report","product")}}),Object(f.jsx)(m,{data:r})]})})]})},C=function(e){var t=e.data,r=void 0===t?[]:t,n=e.onFilter;return Object(f.jsxs)("div",{className:"card",children:[Object(f.jsx)("div",{className:"card-header",children:Object(f.jsx)("h2",{children:"Clientes"})}),Object(f.jsx)("div",{className:"card-body",children:r.length>0&&Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("input",{className:"input-filter",placeholder:"Buscar...",type:"search",onChange:function(e){return n(e.target.value,"client_report","client")}}),Object(f.jsx)(_,{data:r})]})})]})},N=r(222),L=r(218),F=r.n(L),P=function(e){var t=e.placeholder,r=e.loadOptions,n=(e.defaultOptions,e.cacheOptions),c=void 0===n||n,a=e.onSelect;return Object(f.jsx)(N.a,{loadOptions:F()((function(e,t){return r(e,t)}),700),cacheOptions:c,placeholder:t,onChange:a,loadingMessage:function(){return"Cargando..."},isClearable:!0})},R=function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filter,n=r?"?filter=".concat(r):"",e.next=4,fetch("/api/products"+n);case 4:return c=e.sent,e.next=7,c.json();case 7:return a=e.sent,e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/api/reports/products","/buy-price-fluctuation/").concat(t));case 2:return r=e.sent,n=r.json(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(e){var t=e.onSelect,r=function(){var e=Object(u.a)(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({filter:t});case 2:if(!((r=e.sent)&&r.length>0)){e.next=6;break}return n=r.map((function(e){var t=e.Descripcion;return{key:e.id,label:t,value:e}})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(f.jsx)(P,{loadOptions:r,placeholder:"Buscar producto...",onSelect:function(e,r){var n=r.action;"select-option"===n?t(e.value,n):"clear"===n&&t(null,n)}})},B=r(223),H=function(){var e=Object(n.useState)(null),t=Object(j.a)(e,2),r=t[0],c=t[1],a=Object(n.useState)([]),o=Object(j.a)(a,2),i=o[0],s=o[1];return Object(n.useEffect)((function(){if(r){var e=function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(r.idProducto);case 2:t=e.sent,s([t]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else r||s([])}),[r]),Object(f.jsxs)("div",{className:"card",children:[Object(f.jsx)("div",{className:"card-header",children:Object(f.jsx)("h2",{children:"Promedio mensual costo"})}),Object(f.jsx)("div",{className:"card-body"}),Object(f.jsx)(T,{onSelect:c}),Object(f.jsx)("div",{style:{height:"300px"},children:Object(f.jsx)(B.a,{data:i,margin:{top:50,right:50,bottom:50,left:60},xScale:{type:"point"},yScale:{type:"linear",min:"auto",max:"auto",stacked:!0,reverse:!1},axisTop:null,axisRight:null,pointSize:10,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},pointLabelYOffset:-12,useMesh:!0})})]})},A=function(e){var t=e.data,r=void 0===t?[]:t,n=e.onFilter,c=void 0===n?function(){}:n;return Object(f.jsxs)("div",{className:"card",children:[Object(f.jsx)("div",{className:"card-header",children:Object(f.jsx)("h2",{children:"Nuevos clientes"})}),Object(f.jsx)("div",{className:"card-body",children:r.length>0&&Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("input",{className:"input-filter",placeholder:"Buscar...",type:"search",onChange:function(e){return c(e.target.value,"client_report","client")}}),Object(f.jsx)(_,{data:r})]})})]})};var $=function(){var e=Object(n.useState)({from:w.DateTime.now().toISODate(),to:w.DateTime.now().toISODate()}),t=Object(j.a)(e,2),r=t[0],c=t[1],a=Object(n.useState)({sale_report:[],categories_report:[],client_report:[],new_clients_report:[]}),o=Object(j.a)(a,2),s=o[0],p=o[1],h=Object(n.useState)({sale_report:[],categories_report:[],client_report:[],buy_price_fluctuation:[],new_clients_report:[]}),x=Object(j.a)(h,2),v=x[0],m=x[1],g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Object(n.useState)(t),c=Object(j.a)(r,2),a=c[0],o=c[1],i=O()((function(e,t,r){s(e,t,r)}),500),s=function(t,r,n){var c=e[r].filter((function(e){return e[n].toLowerCase().includes(t.toLowerCase())}));o(Object(d.a)(Object(d.a)({},a),{},Object(b.a)({},r,c)))};return{filteredData:a,setFilteredData:o,onFilterDebounced:i}}(s,{sale_report:[],categories_report:[],client_report:[],new_clients_report:[]}),_=g.filteredData,N=g.onFilterDebounced,L=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,S(r);case 3:n=e.sent,p(Object(d.a)({},n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){var e=s.categories_report.reduce((function(e,t){return[].concat(Object(i.a)(e),[{id:t.categoria,label:t.categoria,value:t.rawProfit,netProfit:t.netProfit}])}),[]),t=s.client_report.reduce((function(e,t){return[].concat(Object(i.a)(e),[{id:t.client,label:t.client,value:t.total_USD}])}),[]);m(Object(d.a)(Object(d.a)({},v),{},{categories_report:e,client_report:t}))}),[s]),Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)("div",{id:"date-range-wrapper",children:Object(f.jsxs)("div",{id:"date-range-container",children:[Object(f.jsx)("label",{children:"Desde:"}),Object(f.jsx)("input",{type:"date",value:r.from,onChange:function(e){return c(Object(d.a)(Object(d.a)({},r),{},{from:e.target.value}))}}),Object(f.jsx)("label",{children:"Hasta:"}),Object(f.jsx)("input",{type:"date",value:r.to,onChange:function(e){return c(Object(d.a)(Object(d.a)({},r),{},{to:e.target.value}))}}),Object(f.jsx)("input",{type:"submit",onClick:L})]})}),Object(f.jsxs)("main",{id:"main",children:[Object(f.jsxs)("div",{id:"left-content",children:[Object(f.jsx)(y,{data:_.sale_report.length?_.sale_report:s.sale_report,onFilter:N}),Object(f.jsx)(C,{data:_.client_report.length?_.client_report:s.client_report,onFilter:N}),Object(f.jsx)(H,{}),Object(f.jsx)(A,{data:_.new_clients_report.length?_.new_clients_report:s.new_clients_report,onFilter:N})]}),Object(f.jsxs)("div",{id:"right-content",children:[Object(f.jsxs)("div",{className:"card",children:[Object(f.jsx)("div",{className:"card-header",children:Object(f.jsx)("h2",{children:"Gr\xe1fico de categor\xedas"})}),Object(f.jsx)("div",{className:"card-body",children:v.categories_report.length>0&&Object(f.jsx)("div",{style:{height:"300px"},children:Object(f.jsx)(k.a,{data:v.categories_report,margin:{top:30,right:20,bottom:20,left:20},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,arcLabel:function(e){return"".concat(e.value," (").concat(e.data.netProfit,")")},borderWidth:1,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:"#333333",arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLabelsSkipAngle:10,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},tooltip:function(e){var t=e.datum;return Object(f.jsxs)("div",{className:"tooltip-container",children:[Object(f.jsx)("span",{className:"small-square",style:{background:t.color}}),Object(f.jsx)("strong",{children:t.label}),Object(f.jsx)("label",{children:"Bruto: "}),Object(f.jsxs)("span",{children:["$",Number(t.value).toLocaleString()]}),Object(f.jsx)("label",{children:"Utilidad: "}),Object(f.jsxs)("span",{children:["$",Number(t.data.netProfit).toLocaleString()]})]})}})})})]}),Object(f.jsxs)("div",{className:"card",children:[Object(f.jsx)("div",{className:"card-header",children:Object(f.jsx)("h2",{children:"Gr\xe1fico de clientes"})}),Object(f.jsx)("div",{className:"card-body",children:v.client_report.length>0&&Object(f.jsx)("div",{style:{height:"300px"},children:Object(f.jsx)(k.a,{data:v.client_report,margin:{top:30,right:20,bottom:20,left:20},innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderWidth:1,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:"#333333",arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLabelsSkipAngle:10,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]}})})})]})]})]})]})};o.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)($,{})}),document.getElementById("root"))}},[[369,1,2]]]);
//# sourceMappingURL=main.082e6b76.chunk.js.map